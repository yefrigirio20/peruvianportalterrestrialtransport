CREATE DATABASE IF NOT EXISTS `PERUVIANPORTALTERRESTRIALTRANSPORT` DEFAULT CHARACTER SET latin1 COLLATE latin1_spanish_ci;
USE `PERUVIANPORTALTERRESTRIALTRANSPORT`;

/***************************************/
/************ TABLAS 'SQL' *************/
/***************************************/

CREATE TABLE CLIENTE(
	ID         INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
	NOMBRES    VARCHAR(45)  NULL,
	APELLIDOS  VARCHAR(45)  NULL,
	DIRECCION  VARCHAR(100) NULL,
	DNI        VARCHAR(45)  NULL,
	CUMPLEANOS DATETIME     NULL,
	EMAIL      VARCHAR(45)  NULL,	
	ESTADO     VARCHAR(45)  NULL,
	USUARIO    VARCHAR(45)  NULL,
	PASSWORD   VARCHAR(45)  NULL,
	TIPO       VARCHAR(45)  NULL
);

CREATE TABLE DEPARTAMENTO(
	ID     INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
	NOMBRE VARCHAR(255) NULL
);

CREATE TABLE EMPRESA(
	ID           INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
    RAZON_SOCIAL VARCHAR(45)  NULL,
	PAIS         VARCHAR(45)  NULL,
	RUC          VARCHAR(45)  NULL,
	USUARIO      VARCHAR(45)  NULL,
	PASSWORD     VARCHAR(45)  NULL,
    ESTADO       VARCHAR(45)  NULL,	
    DEPARTAMENTO_ID INT REFERENCES DEPARTAMENTO(ID) ON DELETE CASCADE
);

CREATE TABLE AGENCIA(
	ID         INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
	DIRECCION  VARCHAR(45) NULL,
	EMAIL      VARCHAR(100) NULL,
	ESTADO     VARCHAR(45) NULL,
	NOMBRE     VARCHAR(45) NULL,
	TELEFONO   VARCHAR(45) NULL,
	EMPRESA_ID INT REFERENCES EMPRESA(ID) ON DELETE CASCADE
);

CREATE TABLE VEHICULO (
	ID          INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
	MODELO      VARCHAR(45) NULL,
	NOMBRE      VARCHAR(45) NULL,
	TIPO        VARCHAR(45) NULL,
	SERVICIO_ID INT REFERENCES SERVICIO(ID) ON DELETE CASCADE
);

CREATE TABLE SERVICIO(
	ID          INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
    NOMBRE      VARCHAR(45)  NULL,
	DESCRIPCION VARCHAR(255) NULL,
    MONTO       DOUBLE(9,2)  NULL DEFAULT '0.00',
	AGENCIA_ID  INT REFERENCES AGENCIA(ID)  ON DELETE CASCADE
);

CREATE TABLE ASIENTO(
	ID          INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
	COLUMNA     VARCHAR(45) NULL,
	FILA        VARCHAR(45) NULL,
	ESTADO      VARCHAR(45) NULL,
	VEHICULO_ID INT REFERENCES VEHICULO(ID) ON DELETE CASCADE
);

CREATE TABLE SALIDA(
	ID                   INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
	DEPARTAMENTO_SALIDA  VARCHAR(45) NULL,
	DEPARTAMENTO_DESTINO VARCHAR(45) NULL,
	SERVICIO_ID          INT REFERENCES SERVICIO(ID) ON DELETE CASCADE
);

CREATE TABLE CALENDARIO(
	ID                 INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
	DURACION           INT      NULL,
	FECHA_HORA_SALIDA  DATETIME NULL,
	FECHA_HORA_LLEGADA DATETIME NULL,
	SALIDA_ID          INT REFERENCES SALIDA(ID) ON DELETE CASCADE
);

CREATE TABLE PAGO(
	ID               INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
	NUM_TARJETA      VARCHAR(45) NULL,
	TIPO_PAGO        VARCHAR(45) NULL,
	FECHA_EXPIRACION DATE         NULL
);

CREATE TABLE CLIENTE_PAGO(
	ID         INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
	CLIENTE_ID INT REFERENCES CLIENTE(ID) ON DELETE CASCADE,
    PAGO_ID    INT REFERENCES PAGO(ID)    ON DELETE CASCADE
);

CREATE TABLE TRANSACCION(
	ID              INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
	EMPRESA_ID      INT REFERENCES EMPRESA(ID)      ON DELETE NO ACTION,
    CLIENTE_ID      INT REFERENCES CLIENTE(ID)      ON DELETE NO ACTION,
	AGENCIA_ID      INT REFERENCES AGENCIA(ID)      ON DELETE NO ACTION,
    SERVICIO_ID     INT REFERENCES SERVICIO(ID)     ON DELETE NO ACTION,
	SALIDA_ID       INT REFERENCES SALIDA(ID)       ON DELETE NO ACTION,
    VEHICULO_ID     INT REFERENCES VEHICULO(ID)     ON DELETE NO ACTION,
	ASIENTO_ID      INT REFERENCES ASIENTO(ID)      ON DELETE NO ACTION
);

/***************************************/
/************ INSERTs 'SQL' ************/
/***************************************/

/**** DEPARTAMENTO ****/
INSERT INTO DEPARTAMENTO (ID, NOMBRE) VALUES (1, 'LIMA');
INSERT INTO DEPARTAMENTO (ID, NOMBRE) VALUES (2, 'ICA');
INSERT INTO DEPARTAMENTO (ID, NOMBRE) VALUES (3, 'CHINCHA');
INSERT INTO DEPARTAMENTO (ID, NOMBRE) VALUES (4, 'AYACUCHO');
INSERT INTO DEPARTAMENTO (ID, NOMBRE) VALUES (5, 'CUZCO');
INSERT INTO DEPARTAMENTO (ID, NOMBRE) VALUES (6, 'LORETO');
INSERT INTO DEPARTAMENTO (ID, NOMBRE) VALUES (7, 'PIURA');
INSERT INTO DEPARTAMENTO (ID, NOMBRE) VALUES (8, 'TACNA');
INSERT INTO DEPARTAMENTO (ID, NOMBRE) VALUES (9, 'HUANUCO');
INSERT INTO DEPARTAMENTO (ID, NOMBRE) VALUES (10, 'HUANCAYO');
INSERT INTO DEPARTAMENTO (ID, NOMBRE) VALUES (11, 'CAJAMARCA');
INSERT INTO DEPARTAMENTO (ID, NOMBRE) VALUES (12, 'SAN MARTIN');
INSERT INTO DEPARTAMENTO (ID, NOMBRE) VALUES (13, 'PUNO');
INSERT INTO DEPARTAMENTO (ID, NOMBRE) VALUES (14, 'UCAYALI');
INSERT INTO DEPARTAMENTO (ID, NOMBRE) VALUES (15, 'CHIMBOTE');

/**** EMPRESA ****/
INSERT INTO EMPRESA (ID, PAIS, RAZON_SOCIAL, RUC, USUARIO, PASSWORD, ESTADO, DEPARTAMENTO_ID) VALUES (1, 'PERU', 'CIVA', '22222', 'CIVA', 'CIVA', 'TRUE', 1);
INSERT INTO EMPRESA (ID, PAIS, RAZON_SOCIAL, RUC, USUARIO, PASSWORD, ESTADO, DEPARTAMENTO_ID) VALUES (2, 'PERU', 'OLTURSA', '44444', 'OLTURSA', 'OLTURSA', 'TRUE', 1);
INSERT INTO EMPRESA (ID, PAIS, RAZON_SOCIAL, RUC, USUARIO, PASSWORD, ESTADO, DEPARTAMENTO_ID) VALUES (3, 'PERU', 'CRUZ DEL SUR', '55555', 'CRUZDELSUR', 'CRUZDELSUR', 'TRUE', 1);

/**** AGENCIA ****/
INSERT INTO AGENCIA (ID, DIRECCION, EMAIL, ESTADO, NOMBRE, TELEFONO, EMPRESA_ID) VALUES (1, 'AV.XXXX', 'TRANSPORTECIVA@CIVA.COM', 'TRUE', 'AGENCIA SAN LIMA', '4574512', 1);
INSERT INTO AGENCIA (ID, DIRECCION, EMAIL, ESTADO, NOMBRE, TELEFONO, EMPRESA_ID) VALUES (2, 'AV.XXXX', 'TRANSPORTEOLTURSA@OLTURSA.COM', 'TRUE', 'AGENCIA SAN BORJA', '4555512', 2);
INSERT INTO AGENCIA (ID, DIRECCION, EMAIL, ESTADO, NOMBRE, TELEFONO, EMPRESA_ID) VALUES (3, 'AV.XXXX', 'TRANSPORTECRUZDELSUR@CRUZDELSUR.COM', 'TRUE', 'AGENCIA SAN ISIDRO', '4774512', 3);

/**** SERVICIO ****/
INSERT INTO SERVICIO (ID, NOMBRE, DESCRIPCION, MONTO, AGENCIA_ID ) VALUES (1, 'IMPERIAL', 'AAAA', 40.0, 1 );
INSERT INTO SERVICIO (ID, NOMBRE, DESCRIPCION, MONTO, AGENCIA_ID ) VALUES (2, 'EJECUTIVO', 'BBB', 40.0, 1 );

/**** VEHICULO ****/
INSERT INTO VEHICULO (ID, MODELO, NOMBRE, TIPO, SERVICIO_ID) VALUES (1, 'MQT242', 'VOLVO', '1 PISO',  1);
INSERT INTO VEHICULO (ID, MODELO, NOMBRE, TIPO, SERVICIO_ID) VALUES (2, 'RTR979', 'VOLVO', '2 PISOS', 2);

/**** ASIENTO ****/
INSERT INTO ASIENTO (ID, COLUMNA, ESTADO, FILA, VEHICULO_ID) VALUES (1, 'A', 'FALSE', '1', 1);
INSERT INTO ASIENTO (ID, COLUMNA, ESTADO, FILA, VEHICULO_ID) VALUES (2, 'A', 'FALSE', '2', 1);
INSERT INTO ASIENTO (ID, COLUMNA, ESTADO, FILA, VEHICULO_ID) VALUES (3, 'A', 'FALSE', '3', 1);
INSERT INTO ASIENTO (ID, COLUMNA, ESTADO, FILA, VEHICULO_ID) VALUES (4, 'A', 'FALSE', '4', 1);
INSERT INTO ASIENTO (ID, COLUMNA, ESTADO, FILA, VEHICULO_ID) VALUES (5, 'A', 'FALSE', '5', 1);
INSERT INTO ASIENTO (ID, COLUMNA, ESTADO, FILA, VEHICULO_ID) VALUES (6, 'A', 'FALSE', '6', 1);
INSERT INTO ASIENTO (ID, COLUMNA, ESTADO, FILA, VEHICULO_ID) VALUES (7, 'A', 'FALSE', '7', 1);
INSERT INTO ASIENTO (ID, COLUMNA, ESTADO, FILA, VEHICULO_ID) VALUES (8, 'A', 'FALSE', '8', 1);
INSERT INTO ASIENTO (ID, COLUMNA, ESTADO, FILA, VEHICULO_ID) VALUES (9, 'A', 'FALSE',  '9', 1);
INSERT INTO ASIENTO (ID, COLUMNA, ESTADO, FILA, VEHICULO_ID) VALUES (10, 'B', 'FALSE', '10', 1);
INSERT INTO ASIENTO (ID, COLUMNA, ESTADO, FILA, VEHICULO_ID) VALUES (11, 'B', 'FALSE', '1', 1);
INSERT INTO ASIENTO (ID, COLUMNA, ESTADO, FILA, VEHICULO_ID) VALUES (12, 'B', 'FALSE', '2', 1);
INSERT INTO ASIENTO (ID, COLUMNA, ESTADO, FILA, VEHICULO_ID) VALUES (13, 'B', 'FALSE', '3', 1);
INSERT INTO ASIENTO (ID, COLUMNA, ESTADO, FILA, VEHICULO_ID) VALUES (14, 'B', 'FALSE', '4', 1);
INSERT INTO ASIENTO (ID, COLUMNA, ESTADO, FILA, VEHICULO_ID) VALUES (15, 'B', 'TRUE',  '5', 1);
INSERT INTO ASIENTO (ID, COLUMNA, ESTADO, FILA, VEHICULO_ID) VALUES (16, 'B', 'FALSE', '6', 1);
INSERT INTO ASIENTO (ID, COLUMNA, ESTADO, FILA, VEHICULO_ID) VALUES (17, 'B', 'FALSE', '7', 1);
INSERT INTO ASIENTO (ID, COLUMNA, ESTADO, FILA, VEHICULO_ID) VALUES (18, 'B', 'FALSE', '8', 1);
INSERT INTO ASIENTO (ID, COLUMNA, ESTADO, FILA, VEHICULO_ID) VALUES (19, 'B', 'FALSE', '9', 1);
INSERT INTO ASIENTO (ID, COLUMNA, ESTADO, FILA, VEHICULO_ID) VALUES (20, 'C', 'TRUE',  '10', 1);
INSERT INTO ASIENTO (ID, COLUMNA, ESTADO, FILA, VEHICULO_ID) VALUES (21, 'C', 'FALSE', '1', 1);
INSERT INTO ASIENTO (ID, COLUMNA, ESTADO, FILA, VEHICULO_ID) VALUES (22, 'C', 'FALSE', '2', 1);
INSERT INTO ASIENTO (ID, COLUMNA, ESTADO, FILA, VEHICULO_ID) VALUES (23, 'C', 'FALSE', '3', 1);
INSERT INTO ASIENTO (ID, COLUMNA, ESTADO, FILA, VEHICULO_ID) VALUES (24, 'C', 'FALSE', '4', 1);
INSERT INTO ASIENTO (ID, COLUMNA, ESTADO, FILA, VEHICULO_ID) VALUES (25, 'C', 'TRUE',  '5', 1);
INSERT INTO ASIENTO (ID, COLUMNA, ESTADO, FILA, VEHICULO_ID) VALUES (26, 'C', 'FALSE', '6', 1);
INSERT INTO ASIENTO (ID, COLUMNA, ESTADO, FILA, VEHICULO_ID) VALUES (27, 'C', 'FALSE', '7', 1);
INSERT INTO ASIENTO (ID, COLUMNA, ESTADO, FILA, VEHICULO_ID) VALUES (28, 'C', 'FALSE', '8', 1);
INSERT INTO ASIENTO (ID, COLUMNA, ESTADO, FILA, VEHICULO_ID) VALUES (29, 'C', 'FALSE', '9', 1);
INSERT INTO ASIENTO (ID, COLUMNA, ESTADO, FILA, VEHICULO_ID) VALUES (30, 'D', 'FALSE', '10', 1);
INSERT INTO ASIENTO (ID, COLUMNA, ESTADO, FILA, VEHICULO_ID) VALUES (31, 'D', 'FALSE', '2', 1);
INSERT INTO ASIENTO (ID, COLUMNA, ESTADO, FILA, VEHICULO_ID) VALUES (32, 'D', 'FALSE', '3', 1);
INSERT INTO ASIENTO (ID, COLUMNA, ESTADO, FILA, VEHICULO_ID) VALUES (33, 'D', 'FALSE', '3', 1);
INSERT INTO ASIENTO (ID, COLUMNA, ESTADO, FILA, VEHICULO_ID) VALUES (34, 'D', 'TRUE',  '4', 1);
INSERT INTO ASIENTO (ID, COLUMNA, ESTADO, FILA, VEHICULO_ID) VALUES (35, 'D', 'FALSE', '5', 1);
INSERT INTO ASIENTO (ID, COLUMNA, ESTADO, FILA, VEHICULO_ID) VALUES (36, 'D', 'FALSE', '6', 1);
INSERT INTO ASIENTO (ID, COLUMNA, ESTADO, FILA, VEHICULO_ID) VALUES (37, 'D', 'FALSE', '7', 1);
INSERT INTO ASIENTO (ID, COLUMNA, ESTADO, FILA, VEHICULO_ID) VALUES (38, 'D', 'FALSE', '8', 1);
INSERT INTO ASIENTO (ID, COLUMNA, ESTADO, FILA, VEHICULO_ID) VALUES (39, 'D', 'FALSE', '9', 1);
INSERT INTO ASIENTO (ID, COLUMNA, ESTADO, FILA, VEHICULO_ID) VALUES (40, 'D', 'FALSE', '10', 1);

/**** SALIDA ****/
INSERT INTO SALIDA (ID, DEPARTAMENTO_DESTINO, DEPARTAMENTO_SALIDA, SERVICIO_ID) VALUES (1, 'ICA', 'LIMA', 1);
INSERT INTO SALIDA (ID, DEPARTAMENTO_DESTINO, DEPARTAMENTO_SALIDA, SERVICIO_ID) VALUES (2, 'CUZCO', 'LIMA', 1);
INSERT INTO SALIDA (ID, DEPARTAMENTO_DESTINO, DEPARTAMENTO_SALIDA, SERVICIO_ID) VALUES (3, 'PIURA', 'LIMA', 1);
INSERT INTO SALIDA (ID, DEPARTAMENTO_DESTINO, DEPARTAMENTO_SALIDA, SERVICIO_ID) VALUES (4, 'CAJAMARCA', 'LIMA', 1);

/**** CALENDARIO ****/
INSERT INTO CALENDARIO (ID, DURACION, FECHA_HORA_LLEGADA, FECHA_HORA_SALIDA, SALIDA_ID) VALUES (1, 4, '2010-07-10 08:00:00', '2010-07-10 12:00:00', 1);
INSERT INTO CALENDARIO (ID, DURACION, FECHA_HORA_LLEGADA, FECHA_HORA_SALIDA, SALIDA_ID) VALUES (2, 4, '2010-07-10 10:00:00', '2010-07-10 14:00:00', 1);
INSERT INTO CALENDARIO (ID, DURACION, FECHA_HORA_LLEGADA, FECHA_HORA_SALIDA, SALIDA_ID) VALUES (3, 18, '2010-07-10 08:00:00', '2010-08-10 02:00:00', 2);
INSERT INTO CALENDARIO (ID, DURACION, FECHA_HORA_LLEGADA, FECHA_HORA_SALIDA, SALIDA_ID) VALUES (4, 18, '2010-07-10 09:00:00', '2010-08-10 03:00:00', 2);
INSERT INTO CALENDARIO (ID, DURACION, FECHA_HORA_LLEGADA, FECHA_HORA_SALIDA, SALIDA_ID) VALUES (5, 18, '2010-07-10 10:00:00', '2010-08-10 04:00:00', 2);
INSERT INTO CALENDARIO (ID, DURACION, FECHA_HORA_LLEGADA, FECHA_HORA_SALIDA, SALIDA_ID) VALUES (6, 14, '2010-07-10 08:00:00', '2010-07-10 22:00:00', 3);
INSERT INTO CALENDARIO (ID, DURACION, FECHA_HORA_LLEGADA, FECHA_HORA_SALIDA, SALIDA_ID) VALUES (7, 14, '2010-07-10 09:00:00', '2010-07-10 23:00:00', 3);
INSERT INTO CALENDARIO (ID, DURACION, FECHA_HORA_LLEGADA, FECHA_HORA_SALIDA, SALIDA_ID) VALUES (8, 12, '2010-07-10 08:00:00', '2010-07-10 20:00:00', 4);
INSERT INTO CALENDARIO (ID, DURACION, FECHA_HORA_LLEGADA, FECHA_HORA_SALIDA, SALIDA_ID) VALUES (9, 12, '2010-07-10 09:00:00', '2010-07-10 21:00:00', 4);
INSERT INTO CALENDARIO (ID, DURACION, FECHA_HORA_LLEGADA, FECHA_HORA_SALIDA, SALIDA_ID) VALUES (10, 12, '2010-07-10 10:00:00', '2010-07-10 22:00:00', 4);

/**** CLIENTE ****/
INSERT INTO CLIENTE (ID, APELLIDOS, CUMPLEANOS, DIRECCION, DNI, EMAIL, ESTADO, NOMBRES, PASSWORD, TIPO, USUARIO) VALUES (
1, 'GUERRA ARNAIZ', '2010-07-11', 'AV.NARANJAL 1029 LOS OLIVOS', '41816133', 'CGUERRAA@HP.COM', 'TRUE', 'CESAR RICARDO', 'ADMIN',
'ADMINISTRADOR', 'RGUERRA');

/**** PAGO ****/
INSERT INTO PAGO( ID, FECHA_EXPIRACION, NUM_TARJETA, TIPO_PAGO ) VALUES( 1, '2010-12-11', '4578548778', 'ADMINISTRADOR' );

/**** VEHICULO ****/
INSERT INTO VEHICULO (ID, MODELO, NOMBRE, TIPO, SERVICIO_ID ) VALUES( 1, 'AWQ-333', 'MARCOPOLO', '1 PISO', 1 );
INSERT INTO VEHICULO (ID, MODELO, NOMBRE, TIPO, SERVICIO_ID ) VALUES( 2, 'HQA-786', 'VOLVO', '2 PISOS',  2 );

/**** PAGO ****/
INSERT INTO PAGO (ID, FECHA_EXPIRACION, NUM_TARJETA, TIPO_PAGO) VALUES (1, '2010-12-11 10:00:00', '4578548778', 'ADMINISTRADOR');

/**** CLIENTE_PAGO ****/
INSERT INTO CLIENTE_PAGO (ID, CLIENTE_ID, PAGO_ID) VALUES (1, 1, 1);

/**** TRANSACCION ****/
INSERT INTO TRANSACCION( ID, EMPRESA_ID, CLIENTE_ID, AGENCIA_ID, SERVICIO_ID, SALIDA_ID, VEHICULO_ID, ASIENTO_ID ) VALUES( 1, 1, 1, 1, 1, 1, 1, 1 );


/***************************************/
/*********** CONSULTAS 'SQL' ***********/
/***************************************/

/**** FORMA #1 ****/

SELECT e.RAZON_SOCIAL, e.PAIS, a.NOMBRE, s.NOMBRE,
       sa.DEPARTAMENTO_SALIDA, sa.DEPARTAMENTO_DESTINO,
       c.FECHA_HORA_SALIDA, c.FECHA_HORA_LLEGADA
FROM   EMPRESA e, AGENCIA a, SERVICIO s,
       SALIDA sa, CALENDARIO c 
WHERE  e.ID  = a.ID  AND
       a.ID  = s.ID  AND
       s.ID  = sa.ID AND
       sa.ID = c.ID;


/**** FORMA #2 ****/

SELECT e.RAZON_SOCIAL, e.PAIS, a.NOMBRE, s.NOMBRE,
       sa.DEPARTAMENTO_SALIDA, sa.DEPARTAMENTO_DESTINO,
       c.FECHA_HORA_SALIDA, c.FECHA_HORA_LLEGADA
FROM   EMPRESA    e  INNER  JOIN
       AGENCIA    a  INNER  JOIN
       SERVICIO   s  INNER  JOIN
       SALIDA     sa INNER  JOIN
       CALENDARIO c
ON     e.ID  = a.ID  AND
       a.ID  = s.ID  AND
       s.ID  = sa.ID AND
       sa.ID = c.ID;

